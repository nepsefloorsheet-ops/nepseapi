<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Live NEPSE Data</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f2f4f7;
            padding: 20px;
            color: black;
        }

        h1 {
            text-align: center;
            margin-bottom: 15px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: #ffffff;
            font-size: 14px;
        }

        th,
        td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background: #222;
            color: #fff;
            position: sticky;
            top: 0;
        }

        tr:hover {
            background: #f9f9f9;
        }

        .positive {
            color: green;
            font-weight: bold;
        }

        .negative {
            color: red;
            font-weight: bold;
        }

        img {
            width: 30px;
            height: 30px;
            object-fit: contain;
        }
    </style>
</head>

<body>

    <h1>ðŸ“Š Live NEPSE Market</h1>

    <table>
        <thead>
            <tr>
                <th>Symbol</th>
                <th>Company</th>
                <th>Sector</th>
                <th>LTP</th>
                <th>Change</th>
                <th>%</th>
                <th>Open</th>
                <th>High</th>
                <th>Low</th>
                <th>Prev Close</th>
                <th>Volume</th>
                <th>Transactions</th>
                <th>Value</th>
                <th>Last Updated</th>
            </tr>
        </thead>

        <tbody id="nepse-body"></tbody>
    </table>

    <script>
        async function loadNepse() {
            try {
                const res = await fetch("https://nepseapi-ouhd.onrender.com/api/live-nepse");
                const json = await res.json();

                console.log("API RESPONSE:", json); // DEBUG

                // âœ… HANDLE BOTH array & object responses
                const data = Array.isArray(json)
                    ? json
                    : json.data || json.liveNepse || [];

                const tbody = document.getElementById("nepse-body");
                tbody.innerHTML = "";

                if (data.length === 0) {
                    tbody.innerHTML = "<tr><td colspan='15'>No data available</td></tr>";
                    return;
                }

                data.forEach(item => {
                    const row = document.createElement("tr");
                    const changeClass = item.change >= 0 ? "positive" : "negative";

                    row.innerHTML = `
                <td><strong>${item.symbol}</strong></td>
                <td>${item.securityName}</td>
                <td>${item.sector}</td>
                <td>${item.lastTradedPrice}</td>
                <td class="${changeClass}">${item.change}</td>
                <td class="${changeClass}">${item.percentageChange}%</td>
                <td>${item.openPrice}</td>
                <td>${item.highPrice}</td>
                <td>${item.lowPrice}</td>
                <td>${item.previousClose}</td>
                <td>${item.totalTradeQuantity}</td>
                <td>${item.totalTransactions}</td>
                <td>${item.totalTradeValue}</td>
                <td>${item.lastUpdatedDateTime}</td>
            `;

                    tbody.appendChild(row);
                });

            } catch (err) {
                console.error("JS ERROR:", err);
            }
        }

        loadNepse();
        setInterval(loadNepse, 20000);
    </script>

</body>

</html>